{% extends "base.html" %}
{% load static %}

{% block title %}One Page{% endblock %}

{% block content %}
    <div class="container-fluid">
        <div class="row g-4 px-4 py-2" id="cards-container"></div>
        <div id="loading-indicator" class="text-center py-4" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2 text-muted">Cargando más contenido...</p>
        </div>
        <div id="end-message" class="text-center py-4" style="display: none;">
            <p class="text-muted">Has llegado al final (100 tarjetas mostradas)</p>
        </div>
    </div>

    <script>
    
    const titulos = [
        "Poster Ado", "Inteligencia Artificial", "Base de Datos",
        "Redes Cisco", "Seguridad Informática", "Diseño UX/UI",
        "Cloud Computing", "Internet de las Cosas", "Big Data", "DevOps"
    ];

    const descripciones = [
        "poster 200x200 de Adomination.",
        "El futuro de la tecnología está aquí.",
        "Gestiona grandes volúmenes de información.",
        "Conecta el mundo a través de redes seguras.",
        "Protege la integridad de la información.",
        "Mejora la experiencia del usuario final.",
        "Servicios escalables en la nube.",
        "Conectando dispositivos cotidianos a internet.",
        "Análisis de datos para toma de decisiones.",
        "Integración continua y entrega continua."
    ];

    const imagenes = [
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}",
        "{% static 'img/Adomination.jpg' %}"
    ];

    const container = document.getElementById("cards-container");
    const loadingIndicator = document.getElementById("loading-indicator");
    const endMessage = document.getElementById("end-message");

    const MAX_CARDS = 100;
    const BATCH_SIZE = 12;
    let loadedCards = 0;
    let isLoading = false;

    function createCard() {
        const index = Math.floor(Math.random() * titulos.length);

        const col = document.createElement("div");
        col.className = "col-12 col-sm-6 col-lg-3 mb-4";

        col.innerHTML = `
            <div class="card h-100 shadow-sm">
                <img src="${imagenes[index]}"
                     class="card-img-top"
                     alt="${titulos[index]}"
                     style="height: 200px; object-fit: cover;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">${titulos[index]}</h5>
                    <p class="card-text flex-grow-1">${descripciones[index]}</p>
                    <a href="#" class="btn btn-primary btn-sm mt-auto">Ver más</a>
                </div>
            </div>
        `;

        return col;
    }

    function loadCards() {
        if (isLoading || loadedCards >= MAX_CARDS) return;

        isLoading = true;
        loadingIndicator.style.display = 'block';

        setTimeout(() => {
            const toLoad = Math.min(BATCH_SIZE, MAX_CARDS - loadedCards);
            
            for (let i = 0; i < toLoad; i++) {
                container.appendChild(createCard());
                loadedCards++;
            }

            if (loadedCards >= MAX_CARDS) {
                endMessage.style.display = 'block';
            }

            isLoading = false;
            loadingIndicator.style.display = 'none';
        }, 300); 
    }

    function isNearBottom() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        
        return (scrollTop + windowHeight) >= (documentHeight - 100);
    }

    let scrollTimeout;
    function handleScroll() {
        if (scrollTimeout) {
            clearTimeout(scrollTimeout);
        }
        
        scrollTimeout = setTimeout(() => {
            if (isNearBottom() && !isLoading && loadedCards < MAX_CARDS) {
                loadCards();
            }
        }, 150); 
    }

    loadCards();

    window.addEventListener("scroll", handleScroll);

    window.addEventListener("load", () => {
        if (isNearBottom() && !isLoading && loadedCards < MAX_CARDS) {
            loadCards();
        }
    });
    </script>
{% endblock %}